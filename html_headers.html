<link rel="stylesheet" href="https://unpkg.com/papercss@1.8.3/dist/paper.min.css">

<script>
  function element(tagName, props = {}, style = {}, fn = () => {}) {
    const element = document.createElement(tagName)

    Object.entries(props).forEach(([ key, value ]) => element[key] = value)
    Object.entries(style).forEach(([ key, value ]) => element.style[key] = value)

    const result = fn()
    if (result && "style" in result) {
      element.append(result)
      element[result.tagName.toLowerCase()] = result
    } else if (result && Array.isArray(result)) {
      result.forEach(childElement => {
        element.append(childElement)
        element[childElement.tagName.toLowerCase()] = childElement
      })
    } else if (result) {
      Object.entries(result).forEach(([ name, childElement ]) => {
        element.append(childElement)
        element[name] = childElement
      })
    }

    return element
  }

  function register(instance, hash) {
    Object.entries(hash).forEach(([name, element]) => {
      instance.canvas.append(element)
      instance.data[name] = element
    })
  }

    //console.log(`Updating %c${element.tagName}%c${classNames.length ? "." : ""}%c${classNames.join(".")} %cwith %c${JSON.stringify(style)}`, "color:#DC143C", "color:#000", "color:#006400", "color:#000", "color:#A9A9A9")
  function updateStyle(element, style) {
    const polishedStyle = Object.entries(element.style).reduce((buffer, [ key, value ]) => value === "" ? buffer : Object.assign(buffer, {[key]: value}), {})

    // It didn't work with hover, so just click on 'em in order to get debug info.
    element.addEventListener("click", (e) => {
      console.log(`Click: Style %c${JSON.stringify(style)}%c applied to:`, "color:#A9A9A9", "color:#000")
      console.info("Final style:", polishedStyle) // Debug original style before updating it.
    })

    element.addEventListener("hover", (e) => {
      console.log(`Hover: Style %c${JSON.stringify(style)}%c applied to:`, "color:#A9A9A9", "color:#000")
      console.info("Final style:", polishedStyle) // Debug original style before updating it.
    })

    Object.entries(style).forEach(([property, value]) => {
      element.style[property] = value
    })
  }

  function logErrors(label, fn) {
    try {
      fn()
    } catch (error) {
      console.log(`%c${error.name} %cin %c${label}%c: ${error.message}`, "color:#DC143C", "color:#000", "color:#006400", "color:#000")
    }
  }
</script>
